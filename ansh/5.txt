#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct Node {
    int time;
    char name[50];
    int booked;
    struct Node *next, *prev;
};

struct Node *head = NULL;

struct Node* createNode(int time) {
    struct Node *newNode = (struct Node*)malloc(sizeof(struct Node));
    newNode->time = time;
    strcpy(newNode->name, "");
    newNode->booked = 0;
    newNode->next = newNode->prev = NULL;
    return newNode;
}

void displaySequence() {
    printf("\n--- Appointment Schedule (Booking Order) ---\n");
    struct Node *temp = head;
    if (!temp) {
        printf("No appointments booked yet!\n");
        return;
    }
    while (temp) {
        if (temp->booked)
            printf("%2d:00 - BOOKED %s\n", temp->time, temp->name);
        temp = temp->next;
    }
}

void displaySorted() {
    printf("\n--- Appointment Schedule (Sorted by Time) ---\n");
    for (int t = 9; t <= 17; t++) {
        struct Node *temp = head;
        int found = 0;
        while (temp) {
            if (temp->time == t && temp->booked) {
                printf("%2d:00 - BOOKED %s\n", t, temp->name);
                found = 1;
                break;
            }
            temp = temp->next;
        }
        if (!found) {
            printf("%2d:00 - FREE\n", t);
        }
    }
}

void bookAppointment(int time, char *name) {
    struct Node *newNode = createNode(time);
    newNode->booked = 1;
    strcpy(newNode->name, name);

    if (!head) {
        head = newNode;
    } else {
        struct Node *temp = head;
        while (temp->next) temp = temp->next;
        temp->next = newNode;
        newNode->prev = temp;
    }
    printf(" Appointment booked at %d:00 for %s\n", time, name);
}

void cancelAppointment(int time) {
    struct Node *temp = head;
    while (temp) {
        if (temp->time == time && temp->booked) {
            temp->booked = 0;
            strcpy(temp->name, "");
            printf(" Appointment at %d:00 cancelled.\n", time);
            return;
        }
        temp = temp->next;
    }
    printf("Slot %d:00 not booked!\n", time);
}

void sortByPointer() {
    if (!head || !head->next) return;

    int swapped;
    do {
        swapped = 0;
        struct Node *curr = head;
        while (curr->next) {
            if (curr->time > curr->next->time) {
                struct Node *a = curr;
                struct Node *b = curr->next;
                struct Node *before = a->prev;
                struct Node *after = b->next;

                if (before) before->next = b;
                b->prev = before;

                b->next = a;
                a->prev = b;

                a->next = after;

                if (after) after->prev = a;

                if (head == a) head = b;
                swapped = 1;
            } else {
                curr = curr->next;
            }
        }
    } while (swapped);

    printf(" Sorted list by pointer manipulation.\n");
    displaySorted();
}

int main() {
    int choice, time;
    char name[50];

    while (1) {
        printf("\n--- Appointment Booking Menu ---\n");
        printf("1. Display slots (Booking Order)\n");
        printf("2. Book appointment\n");
        printf("3. Cancel appointment\n");
        printf("4. Sort list (by pointer manipulation & show sorted)\n");
        printf("5. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch (choice) {
            case 1:
                displaySequence();
                break;
            case 2:
                printf("Enter time (9-17) and name: ");
                scanf("%d %49s", &time, name);
                if (time < 9 || time > 17) {
                    printf("⚠ Invalid time! Choose between 9 and 17.\n");
                } else {
                    bookAppointment(time, name);
                }
                break;
            case 3:
                printf("Enter time to cancel (9-17): ");
                scanf("%d", &time);
                cancelAppointment(time);
                break;
            case 4:
                sortByPointer();
                break;
            case 5:
                printf("Exiting...\n");
                return 0;
            default:
                printf("⚠nvalid choice! Try again.\n");
        }
    }
    return 0;
}
